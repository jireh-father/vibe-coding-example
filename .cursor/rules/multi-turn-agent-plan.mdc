---
description: 
globs: 
alwaysApply: false
---
# ë©€í‹°í„´ ì—ì´ì „íŠ¸ êµ¬í˜„ ê³„íš

## ğŸ¯ ëª©í‘œ
ê¸°ì¡´ ë‹¨ì¼í„´ Shopping Agentë¥¼ ë©€í‹°í„´ ëŒ€í™”ê°€ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ í•˜ë˜, ìµœëŒ€í•œ ì‹¬í”Œí•˜ê²Œ êµ¬í˜„

## ğŸ“‹ í˜„ì¬ ìƒíƒœ ë¶„ì„

### ê¸°ì¡´ êµ¬ì¡°
- [backend/agents/shopping_agent.py](mdc:backend/agents/shopping_agent.py): ë‹¨ì¼í„´ ë°©ì‹
- [backend/services/chat_service.py](mdc:backend/services/chat_service.py): ì„¸ì…˜ë³„ ë…ë¦½ì  ì²˜ë¦¬
- [frontend/components/chat_interface.py](mdc:frontend/components/chat_interface.py): ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ UIë§Œ ì¡´ì¬

### ë¬¸ì œì 
- ê° ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ Agent ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- ì´ì „ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ ì•ˆë¨
- ì—°ì†ì ì¸ ì§ˆë¬¸-ë‹µë³€ ë¶ˆê°€ëŠ¥

## ğŸ”§ êµ¬í˜„ ê³„íš

### 1ë‹¨ê³„: LangGraph Memory í™œìš©
**ëª©í‘œ**: LangGraphì˜ ë‚´ì¥ ë©”ëª¨ë¦¬ ê¸°ëŠ¥ ì‚¬ìš© (ê°€ì¥ ì‹¬í”Œí•œ ë°©ë²•)

#### ìˆ˜ì •í•  íŒŒì¼ë“¤:
- [backend/agents/shopping_agent.py](mdc:backend/agents/shopping_agent.py)
- [backend/services/chat_service.py](mdc:backend/services/chat_service.py)

#### êµ¬í˜„ ë°©ë²•:
```python
# LangGraphì˜ MemorySaver ì‚¬ìš©
from langgraph.checkpoint.memory import MemorySaver

# Agent ìƒì„± ì‹œ ë©”ëª¨ë¦¬ ì¶”ê°€
memory = MemorySaver()
agent = create_react_agent(
    model=self.model,
    tools=tools,
    checkpointer=memory  # ë©”ëª¨ë¦¬ ì¶”ê°€
)

# ì„¸ì…˜ë³„ thread_idë¡œ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
config = {"configurable": {"thread_id": session_id}}
response = await agent.ainvoke(messages, config=config)
```

### 2ë‹¨ê³„: ì„¸ì…˜ ê´€ë¦¬ ê°œì„ 
**ëª©í‘œ**: ì„¸ì…˜ë³„ Agent ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©

#### ChatService ìˆ˜ì •:
```python
class ChatService:
    def __init__(self):
        self.agents = {}  # ì„¸ì…˜ë³„ Agent ìºì‹œ
        
    def get_or_create_agent(self, session_id: str):
        if session_id not in self.agents:
            self.agents[session_id] = ShoppingReactAgent(...)
        return self.agents[session_id]
```

### 3ë‹¨ê³„: ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
**ëª©í‘œ**: ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì—°ì† ëŒ€í™” ê°€ëŠ¥

#### êµ¬í˜„ í¬ì¸íŠ¸:
- ì„¸ì…˜ë³„ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ìœ ì§€
- ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ìƒí’ˆ ì¶”ì²œ
- ì´ì „ ê²€ìƒ‰ ê²°ê³¼ ì°¸ì¡° ê°€ëŠ¥

## ğŸ“ ìƒì„¸ êµ¬í˜„ ë‹¨ê³„

### Step 1: ShoppingReactAgent ë©€í‹°í„´ ì§€ì›
```python
# backend/agents/shopping_agent.py ìˆ˜ì •
from langgraph.checkpoint.memory import MemorySaver

class ShoppingReactAgent:
    def __init__(self, google_api_key: str, brave_api_key: str = None):
        # ê¸°ì¡´ ì½”ë“œ ìœ ì§€
        self.memory = MemorySaver()  # ë©”ëª¨ë¦¬ ì¶”ê°€
        
    async def _initialize_agent(self):
        # ê¸°ì¡´ ì½”ë“œì— ë©”ëª¨ë¦¬ ì¶”ê°€
        self.agent = create_react_agent(
            model=self.model,
            tools=tools,
            checkpointer=self.memory
        )
    
    async def search_products(self, query: str, session_id: str):
        # session_idë¥¼ thread_idë¡œ ì‚¬ìš©
        config = {"configurable": {"thread_id": session_id}}
        
        # ë©”ì‹œì§€ì— ì´ì „ ì»¨í…ìŠ¤íŠ¸ ìë™ í¬í•¨ë¨
        response = await self.agent.ainvoke({
            "messages": [("user", query)]
        }, config=config)
```

### Step 2: ChatService ì„¸ì…˜ ê´€ë¦¬
```python
# backend/services/chat_service.py ìˆ˜ì •
class ChatService:
    def __init__(self):
        self.shopping_agent = ShoppingReactAgent(...)  # ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤
        
    async def process_message(self, request: ChatRequest):
        # ì„¸ì…˜ë³„ ì»¨í…ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬
        result = await self.shopping_agent.search_products(
            request.message, 
            request.session_id
        )
```

### Step 3: í”„ë¡ íŠ¸ì—”ë“œ ê°œì„  (ì„ íƒì‚¬í•­)
- [frontend/components/chat_interface.py](mdc:frontend/components/chat_interface.py): ê¸°ì¡´ UI ìœ ì§€
- ì—°ì† ëŒ€í™” ê°€ëŠ¥í•¨ì„ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´í•˜ëŠ” ë©”ì‹œì§€ ì¶”ê°€


